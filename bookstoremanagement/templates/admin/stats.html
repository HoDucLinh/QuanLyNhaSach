{% extends 'admin/base.html' %} {% block body %}
<h1 class="text-center text-danger mt-1">THONG KE BAO CAO</h1>

<div class="row">
  <div class="col-md-5 col-xs-12">
    <table class="table">
      <tr>
        <th>Category id</th>
        <th>Category name</th>
        <th>Doanh thu</th>
      </tr>
      {% for s in stats %}
      <tr>
        <td>{{ s[0] }}</td>
        <td>{{ s[1] }}</td>
        <td>
          {% if s[2] %} {{ "{:,.1f}".format(s[2]) }} VND {% else %} 0 VND {%
          endif %}
        </td>
      </tr>
      {% endfor %}
    </table>
  </div>
  <div class="col-md-5 col-xs-12">
    <form>
      <div class="form-group">
        <input
          type="text"
          class="form-control"
          name="kw"
          placeholder="Nhập từ khóa"
        />
      </div>
      <div class="form-group">
        <input type="date" class="form-control" name="from_date" />
      </div>
      <div class="form-group">
        <input type="date" class="form-control" name="to_date" />
      </div>
      <input type="submit" value="Thống kê" class="btn btn-info" />
    </form>
    <canvas id="categoryChartId"></canvas>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
      let labels=[], info=[]
      let r, g, b;
      let colors = [];
      let borderColors = [];

      {% for s in stats %}
      {% if s[2] %}
        labels.push('{{ s[1] }}')
        info.push({{ s[2] }})

        r = Math.random() * 255;
        g = Math.random() * 255;
        b = Math.random() * 255;
        colors.push(`rgb(${r}, ${g}, ${b}, 0.5)`)
        borderColors.push(`rgb(${r}, ${g}, ${b}, 1)`)
        {% endif %}
      {% endfor %}

      window.onload = function () {
        const ctx = document.getElementById("categoryChartId");
        loadChart(ctx, labels, info, 'bar', colors, borderColors)
  }
  function loadChart(ctx, labels, info, type, colors, borderColors)
    {
      new Chart(ctx, {
            type: type,
            data: {
              labels: labels,
              datasets: [
                {
                  label: "Thống kê doanh thu",
                  data: info,
                  backgroundColor: colors,
                  borderColor: borderColors,
                  borderWidth: 1,
                },
              ],
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true,
                },
              },
            },
          });
        };
</script>

{% endblock %}
