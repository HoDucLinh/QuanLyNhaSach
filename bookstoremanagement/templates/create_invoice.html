<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create New Order</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .card {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: none;
        }
        .card-header {
            background-color: #007bff;
            color: #fff;
            font-weight: bold;
        }
        .btn-primary, .btn-success {
            border-radius: 50px;
        }
        .table thead {
            background-color: #f1f1f1;
        }
        .table th {
            text-align: center;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <div class="card">
        <div class="card-header text-center">
            <h4>Tạo Hóa Đơn Mới</h4>
        </div>
        <div class="card-body">
            <form action="/create-invoice" onsubmit="generateInvoice(event)">
                <!-- Thông tin khách hàng -->
                <div class="mb-4 row">
                    <div class="col-md-6">
                        <label for="customerName" class="form-label">Họ tên khách hàng</label>
                        <input type="text" class="form-control" id="customerName" placeholder="Nhập họ tên khách hàng" required>
                    </div>
                    <div class="col-md-6">
                        <label for="orderDate" class="form-label">Ngày lập hóa đơn</label>
                        <input type="date" class="form-control" id="orderDate">
                    </div>
                </div>
                <!-- Nhân viên -->
                <div class="mb-4">
                    <label for="employee" class="form-label">Nhân viên lập hóa đơn</label>
                    <input type="text" class="form-control" id="employee" value="{{ current_user.name }}" readonly>
                </div>
                <!-- Danh sách sách -->
                <div id="bookItems">
                    <div class="book-item mb-3">
                        <div class="row align-items-end">
                            <div class="col-md-3">
                                <label class="form-label">Sách</label>
                                <select class="form-select book-select" required>
                                    <option value="">Chọn sách</option>
                                    {% for book in books %}
                                    <option value="{{ book.id }}" data-category="{{ book.category.name }}" data-price="{{ book.price }}">{{ book.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Thể loại</label>
                                <input type="text" class="form-control category-input" readonly>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">Số lượng</label>
                                <input type="number" class="form-control quantity-input" min="1" placeholder="Nhập số lượng" value="1" required>
                            </div>
                            <div class="col-md-2">

                                <input type="number" class="form-control price-input" readonly>
                            </div>
                            <div class="col-md-2 text-center">
                                <button type="button" class="btn btn-danger remove-item">Xóa</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Nút thêm sách -->
                <button type="button" class="btn btn-success mb-3 w-100" id="addItem">+ Thêm Sách</button>
                <!-- Nút tạo hóa đơn -->
            </form>
            <form action="">
                <button type="submit" class="btn btn-primary w-100">Tạo Hóa Đơn</button>
            </form>
        </div>
    </div>
</div>

<!-- Modal hiển thị hóa đơn -->
<div class="modal fade" id="invoiceModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Hóa đơn bán sách</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="invoiceContent">
                    <!-- Nội dung hóa đơn sẽ được thêm vào đây -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="printInvoice()">In hóa đơn</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const bookItemsContainer = document.getElementById('bookItems');

    // Xử lý sự kiện khi chọn sách
    bookItemsContainer.addEventListener('change', function (event) {
        if (event.target.classList.contains('book-select')) {
            const selectedOption = event.target.options[event.target.selectedIndex];

            // Lấy thông tin sách từ các attribute
            const category = selectedOption.getAttribute('data-category');
            const price = selectedOption.getAttribute('data-price');

            // Tìm các ô thông tin liên quan trong cùng dòng
            const bookItemRow = event.target.closest('.book-item');
            const categoryInput = bookItemRow.querySelector('.category-input');
            const priceInput = bookItemRow.querySelector('.price-input');

            // Gán giá trị vào các ô
            categoryInput.value = category || ''; // Giá trị thể loại
            priceInput.value = price || 0; // Giá trị giá
        }
    });

    // Thêm sách mới khi nhấn nút "Thêm Sách"
    document.getElementById('addItem').addEventListener('click', function () {
        const newItemHTML = `
        <div class="book-item mb-3">
            <div class="row align-items-end">
                <div class="col-md-3">
                    <label class="form-label">Sách</label>
                    <select class="form-select book-select" required>
                        <option value="">Chọn sách</option>
                        {% for book in books %}
                        <option value="{{ book.id }}" data-category="{{ book.category.name }}" data-price="{{ book.price }}">{{ book.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Thể loại</label>
                    <input type="text" class="form-control category-input" readonly>
                </div>
                <div class="col-md-2">
                    <label class="form-label">Số lượng</label>
                    <input type="number" class="form-control quantity-input" min="1" placeholder="Nhập số lượng" required>
                </div>
                <div class="col-md-2">
                    <label class="form-label">Giá</label>
                    <input type="number" class="form-control price-input" readonly>
                </div>
                <div class="col-md-2 text-center">
                    <button type="button" class="btn btn-danger remove-item">Xóa</button>
                </div>
            </div>
        </div>`;
        bookItemsContainer.insertAdjacentHTML('beforeend', newItemHTML);
    });

    // Xóa một mục sách
    bookItemsContainer.addEventListener('click', function (event) {
        if (event.target.classList.contains('remove-item')) {
            const bookItemRow = event.target.closest('.book-item');
            bookItemRow.remove();
        }
    });
});
</script>
</body>
</html>
