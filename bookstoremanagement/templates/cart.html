{% extends 'layout/main.html' %}

{% block content %}
<!-- Cart content -->
<div class="container my-5" id="download-app">
    <h2>Giỏ hàng của bạn</h2>

    <!-- Cart table -->
    <table class="table table-bordered cart-table">
        <thead>
            <tr>
                <th>Sách</th>
                <th>Giá</th>
                <th>Số lượng</th>
                <th>Tổng cộng</th>
            </tr>
        </thead>
        <tbody>
            <!-- Product 1 -->
            <tr>
                <td>Công nghệ lập trình Python</td>
                <td class="price">250000 VND</td>
                <td>
                    <input type="number" name="quantity" value="1" min="1" max="10" class="quantity" data-price="250000" style="width: 50px;">
                </td>
                <td class="total">250000 VND</td>
                <td>
                    <form method="POST" action="/remove_from_cart">
                        <input type="hidden" name="book_id" value="1">
                        <button class="btn btn-danger btn-sm" type="submit">Xóa</button>
                    </form>
                </td>
            </tr>

            <!-- Product 2 -->
            <tr>
                <td>Hướng dẫn học máy cơ bản</td>
                <td class="price">300000 VND</td>
                <td>
                    <input type="number" name="quantity" value="2" min="1" max="10" class="quantity" data-price="300000" style="width: 50px;">
                </td>
                <td class="total">600000 VND</td>
                <td>
                    <form method="POST" action="/remove_from_cart">
                        <input type="hidden" name="book_id" value="2">
                        <button class="btn btn-danger btn-sm" type="submit">Xóa</button>
                    </form>
                </td>
            </tr>
        </tbody>
    </table>

    <!-- Cart Summary -->
    <div class="cart-summary">
        <h4 id="total-price">Tổng cộng: 850000 VND</h4>
        <div class="cart-actions">
            <button class="btn btn-success" type="submit">Thanh toán</button>
        </div>
    </div>
</div>

<script>
    // Lấy tất cả các ô nhập số lượng và tổng cộng
    const quantities = document.querySelectorAll('.quantity');
    const totals = document.querySelectorAll('.total');
    const totalPriceElement = document.getElementById('total-price');

    // Cập nhật giá mỗi khi số lượng thay đổi
    quantities.forEach((quantity, index) => {
        quantity.addEventListener('input', function () {
            const price = parseInt(this.getAttribute('data-price')); // Lấy giá của sản phẩm
            const quantityValue = parseInt(this.value); // Lấy số lượng người dùng nhập
            const total = price * quantityValue; // Tính tổng cộng cho sản phẩm

            totals[index].innerText = total + ' VND'; // Cập nhật tổng cộng của sản phẩm

            // Cập nhật tổng cộng giỏ hàng
            updateCartTotal();
        });
    });

    // Cập nhật tổng cộng giỏ hàng
    function updateCartTotal() {
        let totalCart = 0;
        totals.forEach(total => {
            totalCart += parseInt(total.innerText.replace(' VND', ''));
        });
        totalPriceElement.innerText = 'Tổng cộng: ' + totalCart + ' VND';
    }
</script>

{% endblock %}
